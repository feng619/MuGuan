<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
	<title>慕光之城</title>
	<link rel='shortcut icon' href='img/favicon.ico' type='image/x-icon'/ >
	<link rel="stylesheet" type="text/css" href="css/reset.css">	
	<link rel="stylesheet" type="text/css" href="css/common.css">
	<link rel="stylesheet" type="text/css" href="css/nav.css">	
	<link rel="stylesheet" type="text/css" href="css/footer.css">
	<link rel="stylesheet" type="text/css" href="css/font-awesome-4.6.3/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="css/08about.css">
	<script src="js/jquery-3.1.0.min.js"></script>

	<link rel="stylesheet" type="text/css" href="css/login.css">
  <script type="text/javascript" src="http://d3js.org/topojson.v1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" ></script>
</head>
<body>
	<?php include 'login.php';?>
	<div class="wrapper">
		<header class="head8">

			<?php include 'nav.php';?>
			<p class="page_title">關於</p>

		</header>




    <h2>起源</h2>
		<section class="s81">
      <div class="s81_cont">
        <p>「慕光之城—蛾類世界」是由特有生物研究保育中心（以下簡稱特生中心）賞蛾推動小組於 2011 年 4 月在社群網站「臉書」所成立的社團，目的是：「推動賞蛾風氣，分享賞蛾資訊，交流蛾類知識，並將社團內由社員分享的資料建入資料庫，以累積蛾類組成與分布的時空資訊，以供作為長期監測生態環境變化趨勢之指標」。</p><br>
        <p>本社團自成立至 2012 年 12 月已有 1300 位以上的網友加入，我們暱稱這些網友為「蛾友」，取其「與蛾為友、以蛾會友」的意思。</p>
      </div>
      <div class="s81_cont">
  			<p>特生中心「高海拔試驗站」是從 2006 年開始進行蛾類的調查研究工作，最初是在在合歡山小風口地區進行蛾類的採集、標本製作、鑑定、建檔等最基礎的資料收集工作，並逐漸將採集工作擴展至台 8 線東段地區。</p><br>
        <p>2009 年與鳥類研究室共同研提一項4年的計畫「建立全民參與式長期生態監測系統─鳥類、蛾類」，主要是希望藉由公民參與的方式來進行鳥類與蛾類的調查研究工作。</p>
      </div>
		</section>






		<section class="s82">
			<div class="s82_content">
				<div class="imgbox">
					<img src="img/mm08.jpg">
				</div>
				<div class="s82_content_text">
					<p>鳥類已是最多民眾參與自然觀察的類群，而蛾類對於大部分民眾仍然相當的陌生，且以物種數而言，台灣的鳥類僅有 500 多種，但台灣的蛾類已知的就超過 4100 種以上，因此在前述計畫的推動上，蛾類是先由推動校園師生對於蛾類的認識開始，希望能藉此提生賞蛾的風氣，擴大賞蛾的人口。</p>
				</div>
			</div>
		</section>





		<section class="s83">
      <div>
        <div class="s83_box_p">
  			 <p>2010 年已在全球風行的社群網站「臉書」，突然因為「開心農場」這項網路遊戲而開始在台灣掀起熱潮，特生中心賞蛾推動小組也注意到這項趨勢，因此就在 2011 年的 4 月應用「臉書」成立「慕光之城—蛾類世界」這個社團，本項年報的內容就是要報導我們藉由這個社團所收集到的「蛾類出現原始資料」以及這些資料的初步分析結果。</p>
        </div>

  			<div class="s83_box">
          <div class="imgbox">
            <img src="img/mm07.jpg">
          </div>
  			</div>
      </div>
		</section>





    <h2>成果報告</h2>
      <div class="chart_title_c">
        <h3 class="chart_title">資料提供者與資料數量</h3>
      </div>
      <p class="chart_p">提供資料數量前 5 多的蛾友與他們所提供的資料數量作圖如下：</p>
    <section class="s87">
    
      <div class="s87_content">
        <a id='s87b' class="grey_btn">轉換</a>
        <div class="s87_imgwrapper">
          <div class="imgbox">
            <img src="img/mm01.jpg" class='s87img'>
          </div>
          <div class="imgbox">
            <img src="img/mm09.jpg" class='s87img'>
          </div>
          <div class="imgbox">
            <img src="img/mm10.jpg" class='s87img'>
          </div>
          <div class="imgbox">
            <img src="img/mm02.jpg" class='s87img'>
          </div>
          <div class="imgbox">
            <img src="img/mm03.jpg" class='s87img'>
          </div>
        </div>
      </div>
    </section>




    <section class="s86">
      <div class="chart_title_c">
        <h3 class="chart_title">資料地圖分布與資料數量</h3>
      </div>
      <p class="chart_p">統計資料數量前 7 多的地點與該地點的資料數量分布圖如下：</p>
    </section>




		<section class="s85">
      <div class="chart_title_c">
        <h3 class="chart_title">物種分布與資料數量</h3>
      </div>
      <p class="chart_p">累計資料數量前 30 多的蛾種與累計的資料數量作圖如下：</p>  
			<div class="descrip"></div>
		</section>



	<?php include 'footer.php';?>


    <script>

   
                       
        var nodes = [ { name:'Arctiidae', num: 40, rank: 0 , chinese: '燈蛾科' , link: ''},
        			  { name:'Chrysaeglia magnifica', num: 312, rank: 1 , chinese: '閃光苔蛾' , link: 'https://c2.staticflickr.com/4/3262/3181433609_b7d662df48_o.jpg'},
                      { name:'Aglaomorpha histrio formosana', num: 44, rank: 9 , chinese: '大麗燈蛾' , link: 'https://c2.staticflickr.com/2/1321/4605996898_48475ccba1_o.jpg'},
                      { name:'Macrobrochis gigas', num: 38, rank: 12 , chinese: '巨網燈蛾' , link: 'https://c2.staticflickr.com/4/3346/4605996758_40db4f0a8f_o.jpg'},
                      { name:'Cyana hamata', num: 35, rank: 14 , chinese: '二斑叉紋苔蛾' , link: 'https://c2.staticflickr.com/2/1275/4677574806_c3882dc7e4_b.jpg'},
                      { name:'Nyctemera adversata', num: 30, rank: 18 , chinese: '粉蝶燈蛾' , link: 'https://c2.staticflickr.com/4/3742/9711902914_262e80ecc2_b.jpg'},
                      { name:'Lemyra rhodophilodes', num: 28, rank: 22 , chinese: '白污燈蛾' , link: 'https://c1.staticflickr.com/7/6053/6263988502_c24fd8c149_b.jpg'},
                      { name:'Miltochrista sauteri', num: 25, rank: 28 , chinese: '華麗美苔蛾' , link: 'https://c1.staticflickr.com/5/4117/4738628656_e48c4b97c2_b.jpg'},  //6,7

                      { name:'Noctuidae', num: 40, rank: 0 , chinese: '夜蛾科' , link: ''},
                      { name:'Asota heliconia zebrina', num: 138, rank: 2 , chinese: '圓端擬燈蛾' , link: 'https://c2.staticflickr.com/4/3096/2712314648_c82f7628c8_b.jpg'},
                      { name:'Asota plana lacteata', num: 33, rank: 15 , chinese: '長斑擬燈蛾' , link: 'https://c1.staticflickr.com/3/2716/4085293436_23378981d8_o.jpg'},
                      { name:'Spodoptera litura', num: 28, rank: 21 , chinese: '斜紋夜蛾' , link: 'https://farm4.static.flickr.com/3140/2985543967_9e63fae9af.jpg'},
                      { name:'Erebus ephesperis', num: 25, rank: 30 , chinese: '魔目夜蛾' , link: 'https://c2.staticflickr.com/4/3515/3182267162_0276e72c5f_o.jpg'}, // 12

                      { name:'Geometridae', num: 40, rank: 0 , chinese: '尺蛾科' , link: ''},
                      { name:'Milionia zonea pryeri', num: 97, rank: 3 , chinese: '橙帶枝尺蛾' , link: 'http://3.blog.xuite.net/3/6/6/2/23308280/blog_1910120/txt/47102330/2.jpg'},  // 13 , 14
                      { name:'Mixochlora vittata', num: 54, rank: 7 , chinese: '三岔鐮翅綠尺蛾' , link: 'http://7.share.photo.xuite.net/mbbrgs/1757de7/11687359/553261096_m.jpg'},
                      { name:'Hyposidra talaca', num: 35, rank: 13 , chinese: '突角黯鉤尺蛾' , link: 'http://7.share.photo.xuite.net/mbbrgs/1757d67/11687359/552053672_m.jpg'},
                      { name:'Cleora fraterna', num: 31, rank: 17 , chinese: '黑腰鋸尺蛾' , link: 'https://3.bp.blogspot.com/-toX9QfWfHcg/VsHvnEbxlBI/AAAAAAAAE-I/CHmmQj9chKo/s1600/DSC_3356.JPG-2.jpg'},
                      { name:'Traminda aventiaria', num: 28, rank: 23 , chinese: '缺口姬尺蛾' , link: 'https://c2.staticflickr.com/4/3327/3179466064_c194a127d9_o.jpg'},
                      { name:'Eumelea ludovicata', num: 27, rank: 24 , chinese: '雌黃粉尺蛾' , link: 'https://c2.staticflickr.com/4/3549/3807325652_a038c493ff_o.jpg'},
                      { name:'Biston perclarus', num: 27, rank: 25 , chinese: '黑線黃尺蛾' , link: 'https://c2.staticflickr.com/4/3146/2658901190_ba02ac0f5c_o.jpg'},
                      { name:'Pingasa ruginaria pacifica', num: 27, rank: 26 , chinese: '基黃粉尺蛾' , link: 'http://image.digitalarchives.tw/ImageCache/00/5d/b4/29.jpg'},// 21

                      { name:'Bombycidae', num: 40, rank: 0 , chinese: '蠶蛾科' , link: ''},
                      { name:'Ernolatia moorei', num: 73, rank: 4 , chinese: '黑點白蠶蛾' , link: 'http://e.share.photo.xuite.net/r0123401234/1e58387/9650416/423260823_m.jpg'}, // 23

                      { name:'Zygaenidae', num: 40, rank: 0 , chinese: '斑蛾科' , link: ''},
                      { name:'Histia flabellicornis ultima', num: 72, rank: 5 , chinese: '重陽木螢斑蛾' , link: 'http://pic.pimg.tw/dr590921/1379734541-1070384989.jpg'},
                      { name:'Eterusia aedea formosana', num: 26, rank: 27 , chinese: '蓬萊茶斑蛾' , link: 'http://farm8.staticflickr.com/7140/8163312981_34fb640561.jpg'}, // 26

                      { name:'Lasiocampidae', num: 40, rank: 0 , chinese: '枯葉蛾科' , link: ''},
                      { name:'Trabala vishnou guttata', num: 72, rank: 6 , chinese: '青枯葉蛾' , link: 'http://farm9.staticflickr.com/8154/7373947080_2ff2a766c4.jpg'},
                      { name:'Lebeda nobilis', num: 30, rank: 20 , chinese: '大灰枯葉蛾' , link: 'http://twmoth.tesri.gov.tw/images/twmoth002/twmoth009013.jpg'}, // 29

                      { name:'Sphingidae', num: 40, rank: 0 , chinese: '天蛾科' , link: ''},
                      { name:'Acherontia lachesis', num: 45, rank: 8 , chinese: '鬼臉天蛾' , link: 'http://twmoth.tesri.gov.tw/images/twmoth006/twmoth025572.jpg'}, //31

                      { name:'Saturniidae', num: 40, rank: 0 , chinese: '天蠶蛾科' , link: ''},
                      { name:'Actias heterogyna subaurea', num: 44, rank: 10 , chinese: '台灣長尾水青蛾' , link: 'http://twmoth.tesri.gov.tw/images/twmoth008/twmoth035130.jpg'},
                      { name:'Loepa formosensis', num: 39, rank: 11 , chinese: '黃豹天蠶蛾' , link: 'http://farm9.staticflickr.com/8155/7654024784_644a13885b.jpg'},
                      { name:'Actias selene ningpoana', num: 33, rank: 16 , chinese: '長尾水青蛾' , link: 'https://c1.staticflickr.com/7/6110/6268693719_7e9e403cba_b.jpg'},
                      { name:'Attacus atlas formosanus', num: 30, rank: 19 , chinese: '皇蛾' , link: 'http://3.share.photo.xuite.net/jodyhsieh/1377e2c/12804908/647155712_m.jpg'}, //36

                      { name:'Callidulidae', num: 40, rank: 0 , chinese: '錨紋蛾科' , link: ''},
                      { name:'Callidula attenuata', num: 25, rank: 29 , chinese: '帶錨紋蛾' , link: 'http://4.share.photo.xuite.net/fongwen1951/1430db0/12346569/604031975_m.jpg'}, //38
                      //根目錄
                      { name:'Moth', num: 40, rank: -1 , chinese: '鱗翅目' , link: ''}
                      ];
                     
        var edges = [  { source : 0  , target: 1 } , { source : 0  , target: 2 } ,
                       { source : 0  , target: 3 } , { source : 0  , target: 4 } ,
                       { source : 0  , target: 5 } , { source : 0  , target: 6 } ,
                       { source : 0  , target: 7 } ,

                       { source : 8  , target: 9 } , { source : 8  , target: 10} ,
                       { source : 8  , target: 11} , { source : 8  , target: 12} ,
                       
                       { source : 13 , target: 14} , { source : 13 , target: 15} ,
                       { source : 13 , target: 16} , { source : 13 , target: 17} ,
                       { source : 13 , target: 18} , { source : 13 , target: 19} ,
                       { source : 13 , target: 20} , { source : 13 , target: 21} ,

                       { source : 22 , target: 23} , 

                       { source : 24 , target: 25} , { source : 24 , target: 26} ,

                       { source : 27 , target: 28} , { source : 27 , target: 29} ,

                       { source : 30 , target: 31} ,

                       { source : 32 , target: 33} , { source : 32 , target: 34} ,
                       { source : 32 , target: 35} , { source : 32 , target: 36} ,

                       { source : 37 , target: 38} ,

                       //連結所有科名

                       { source : 39 , target: 0 } , { source : 39 , target: 8 } ,
                       { source : 39 , target: 13} , { source : 39 , target: 22} ,
                       { source : 39 , target: 24} , { source : 39 , target: 27} ,
                       { source : 39 , target: 30} , { source : 39 , target: 32} ,
                       { source : 39 , target: 37} 
                    ];    
        
        var width = 800;
        var height = 700;
        
        
        var svg3 = d3.select(".s85")
                    .append("svg")
                    .attr("width",width)
                    .attr("height",height);
        
        var force = d3.layout.force()
                .nodes(nodes)       //指定節點數組
                .links(edges)       //指定連線數組
                .size([width,height])   //指定範圍
                .linkDistance(150)  //指定連線長度
                .charge(-400);  //相互之間的作用力

        force.start();  //開始作用

        
        //添加連線      
        var svg_edges = svg3.selectAll("line")
                            .data(edges)
                            .enter()
                            .append("line")
                            .style("stroke","#ccc")
                            .style("stroke-width",1);
        
        var color = d3.scale.category20();



        //添加節點 

        var lock_link,lock_chinese,lock_rank,lock_num;         
        var svg_nodes = svg3.selectAll("circle")
                            .data(nodes)
                            .enter()
                            .append("circle")
                            .attr("r",function(d,i){return Math.round(d.num/4)})
                            .style("fill",function(d,i){
                            	var rk = d.rank;
                            	if(rk==-1){return '#333'}else if(rk==0){return '#666'}else{return '#bbb'}
                            })
                            .on('click',function(d,i){
                              if($(this).hasClass('lock_circle')){
                                $(this).removeClass('lock_circle');
                              }else{
                                svg3.selectAll("circle")
                                .classed('lock_circle',false)
                                .style("fill",function(d,i){
                                  var rk = d.rank;
                                  if(rk==-1){return '#333'}else if(rk==0){return '#666'}else{return '#bbb'}
                                });
                                d3.select(this).classed('lock_circle',true).style('fill','#0D6FB8');

                                lock_link = d.link;
                                lock_chinese = d.chinese;
                                lock_rank = d.rank;
                                lock_num = d.num;

                              }
                            })
                            .on('mouseover',function(d,i){
                                // var col = color(i);
                                var link = d.link;
                                var chinese = d.chinese;
                                var rank = d.rank;
                                var num = d.num;
                                var des = d3.select('.descrip'); 
                                d3.selectAll('.desimg').remove();
                                d3.selectAll('.desh3').remove();
                                d3.selectAll('.desp').remove();

                                link?
                                  des.append('img').attr('class','desimg').attr('src',link) :
                                  des.append('img').attr('class','desimg').attr('src',link).style('visibility','hidden');

                                des.append('h3').attr('class','desh3').text(chinese);
                                des.append('p').attr('class','desp').text(
                                  rank>0 ?'資料數: '+num+' 排名: '+rank : ''
                                 );

                              if(!$("circle").hasClass('lock_circle')){//沒人有.lock_circle
                                d3.select(this).style("fill",'#F39800');
                              }else if($(this).hasClass('lock_circle')){//剛好這個有.lock_circle
                                d3.select(this).style("fill",'#0D6FB8');
                              }else{//某人有.lock_circle
                                d3.select(this).style("fill",'#F39800');
                              }
                                
                              
                            })
                            .on('mouseout',function(d,i){
                                d3.select('.desimg').remove();
                                d3.select('.desh3').remove();
                                d3.select('.desp').remove();
                              if(!$("circle").hasClass('lock_circle')){//沒人有.lock_circle
                                d3.select(this).style("fill",function(d,i){
                            		var rk = d.rank;
                            		if(rk==-1){return '#333'}else if(rk==0){return '#666'}else{return '#bbb'}
                            	  });
                              }else if($(this).hasClass('lock_circle')){//剛好這個有.lock_circle
                                var des = d3.select('.descrip');

                                d.link?
                                  des.append('img').attr('class','desimg').attr('src',d.link) :
                                  des.append('img').attr('class','desimg').attr('src',d.link).style('visibility','hidden');

                                des.append('h3').attr('class','desh3').text(d.chinese);
                                des.append('p').attr('class','desp').text(
                                  d.rank>0 ?'資料數: '+d.num+' 排名: '+d.rank : ''
                                 );
                              }else{//某人有.lock_circle
                                d3.select(this).style("fill",function(d,i){
                                var rk = d.rank;
                                if(rk==-1){return '#333'}else if(rk==0){return '#666'}else{return '#bbb'}
                                });

                                var des = d3.select('.descrip');

                                lock_link?
                                  des.append('img').attr('class','desimg').attr('src',lock_link) :
                                  des.append('img').attr('class','desimg').attr('src',lock_link).style('visibility','hidden');

                                des.append('h3').attr('class','desh3').text(lock_chinese);
                                des.append('p').attr('class','desp').text(
                                  '資料數: '+lock_num+' 排名: '+lock_rank
                                 );

                              }
                            })
                            .call(force.drag);  //使得節點能夠拖動

        //添加描述節點的文字
        var svg_texts = svg3.selectAll("text")
                            .data(nodes)
                            .enter()
                            .append("text")
                            .style("fill", "black")
                            .style('font-size', '8px')
                            .attr("dx", 20)
                            .attr("dy", 8)
                            .text(function(d){
                                return d.name;
                            });
                    

        force.on("tick", function(){    //對於每一個時間間隔
        
             //更新連線座標
             svg_edges.attr("x1",function(d){ return d.source.x; })
                    .attr("y1",function(d){ return d.source.y; })
                    .attr("x2",function(d){ return d.target.x; })
                    .attr("y2",function(d){ return d.target.y; });
             
             //更新節點座標
             svg_nodes.attr("cx",function(d){ return d.x; })
                    .attr("cy",function(d){ return d.y; });

             //更新文字座標
             svg_texts.attr("x", function(d){ return d.x; })
                .attr("y", function(d){ return d.y; });
        });






    </script>

  <script>

    var topodata = {"type":"Topology","objects":{"county":{"type":"GeometryCollection","bbox":[116.7062384090001,20.697301579000055,124.56114950000006,26.385278129000085],"geometries":[{"type":"MultiPolygon","properties":{"OBJECTID":1,"Area":29735060.5483,"County_ID":"09007","C_Name":"連江縣","Add_Date":"1899-11-29T16:00:00.000Z","Add_Accept":null,"Remark":null},"arcs":[[[0]]]},{"type":"MultiPolygon","properties":{"OBJECTID":2,"Area":185005359.138,"County_ID":"09020","C_Name":"金門縣","Add_Date":"1899-11-29T16:00:00.000Z","Add_Accept":null,"Remark":null},"arcs":[[[1]],[[2]]]},{"type":"MultiPolygon","properties":{"OBJECTID":3,"Area":2201426268.76,"County_ID":"10002","C_Name":"宜蘭縣","Add_Date":"1899-11-29T16:00:00.000Z","Add_Accept":null,"Remark":null},"arcs":[[[3,4,5,6,7,8]]]},{"type":"Polygon","properties":{"OBJECTID":4,"Area":1411565106.52,"County_ID":"10004","C_Name":"新竹縣","Add_Date":"1899-11-29T16:00:00.000Z","Add_Accept":null,"Remark":null},"arcs":[[-7,9,10,11,12,13]]},{"type":"Polygon","properties":{"OBJECTID":5,"Area":1826676683.67,"County_ID":"10005","C_Name":"苗栗縣","Add_Date":"1899-11-29T16:00:00.000Z","Add_Accept":null,"Remark":null},"arcs":[[-11,14,15,16]]},{"type":"Polygon","properties":{"OBJECTID":6,"Area":1244549081.72,"County_ID":"10007","C_Name":"彰化縣","Add_Date":"1899-11-29T16:00:00.000Z","Add_Accept":null,"Remark":null},"arcs":[[17,18,19,20]]},{"type":"Polygon","properties":{"OBJECTID":7,"Area":4097754662.36,"County_ID":"10008","C_Name":"南投縣","Add_Date":"1899-11-29T16:00:00.000Z","Add_Accept":null,"Remark":null},"arcs":[[21,22,23,24,-19,25]]},{"type":"MultiPolygon","properties":{"OBJECTID":8,"Area":1399574918.65,"County_ID":"10009","C_Name":"雲林縣","Add_Date":"1899-11-29T16:00:00.000Z","Add_Accept":null,"Remark":null},"arcs":[[[26]],[[-25,27,28,-20]]]},{"type":"MultiPolygon","properties":{"OBJECTID":9,"Area":1952762204.55,"County_ID":"10010","C_Name":"嘉義縣","Add_Date":"1899-11-29T16:00:00.000Z","Add_Accept":null,"Remark":null},"arcs":[[[-24,29,30,31,-28],[32]]]},{"type":"MultiPolygon","properties":{"OBJECTID":10,"Area":2805016552.2,"County_ID":"10013","C_Name":"屏東縣","Add_Date":"1899-11-29T16:00:00.000Z","Add_Accept":null,"Remark":null},"arcs":[[[33,34,35]]]},{"type":"MultiPolygon","properties":{"OBJECTID":11,"Area":3581832603.27,"County_ID":"10014","C_Name":"臺東縣","Add_Date":"1899-11-29T16:00:00.000Z","Add_Accept":null,"Remark":null},"arcs":[[[36]],[[37]],[[38,-34,39,40]]]},{"type":"Polygon","properties":{"OBJECTID":12,"Area":4605695449.58,"County_ID":"10015","C_Name":"花蓮縣","Add_Date":"1899-11-29T16:00:00.000Z","Add_Accept":null,"Remark":null},"arcs":[[41,-41,42,-22,43,-5]]},{"type":"MultiPolygon","properties":{"OBJECTID":13,"Area":135223749.493,"County_ID":"10016","C_Name":"澎湖縣","Add_Date":"1899-11-29T16:00:00.000Z","Add_Accept":null,"Remark":null},"arcs":[[[44]],[[45]]]},{"type":"MultiPolygon","properties":{"OBJECTID":14,"Area":137570190.544,"County_ID":"10017","C_Name":"基隆市","Add_Date":"1899-11-29T16:00:00.000Z","Add_Accept":null,"Remark":null},"arcs":[[[46,47]]]},{"type":"Polygon","properties":{"OBJECTID":15,"Area":124389934.739,"County_ID":"10018","C_Name":"新竹市","Add_Date":"1899-11-29T16:00:00.000Z","Add_Accept":null,"Remark":null},"arcs":[[-17,48,-12]]},{"type":"Polygon","properties":{"OBJECTID":16,"Area":59722166.0789,"County_ID":"10020","C_Name":"嘉義市","Add_Date":"1899-11-29T16:00:00.000Z","Add_Accept":null,"Remark":null},"arcs":[[-33]]},{"type":"Polygon","properties":{"OBJECTID":17,"Area":269847319.981,"County_ID":"63","C_Name":"臺北市","Add_Date":"1899-11-29T16:00:00.000Z","Add_Accept":null,"Remark":null},"arcs":[[49]]},{"type":"MultiPolygon","properties":{"OBJECTID":18,"Area":2995099782.37,"County_ID":"64","C_Name":"高雄市","Add_Date":"2010-12-24T16:00:00.000Z","Add_Accept":"內政部98年9月1日台內民字第0980162925號令","Remark":"五都改制"},"arcs":[[[-43,-40,-36,50,51,-30,-23]]]},{"type":"Polygon","properties":{"OBJECTID":19,"Area":2066260788.66,"County_ID":"65","C_Name":"新北市","Add_Date":"2010-12-24T16:00:00.000Z","Add_Accept":"內政部98年9月1日台內民字第0980162925號令","Remark":"五都改制"},"arcs":[[-47,52,-9,53,54],[-50]]},{"type":"Polygon","properties":{"OBJECTID":20,"Area":2239785479.54,"County_ID":"66","C_Name":"臺中市","Add_Date":"2010-12-24T16:00:00.000Z","Add_Accept":"內政部98年9月1日台內民字第0980162925號令","Remark":"五都改制"},"arcs":[[-44,-26,-18,55,-15,-10,-6]]},{"type":"Polygon","properties":{"OBJECTID":21,"Area":2258815738.57,"County_ID":"67","C_Name":"臺南市","Add_Date":"2010-12-24T16:00:00.000Z","Add_Accept":"內政部98年9月1日台內民字第0980162925號令","Remark":"五都改制"},"arcs":[[-52,56,-31]]},{"type":"Polygon","properties":{"OBJECTID":22,"Area":1217223234.53,"County_ID":"68","C_Name":"桃園市","Add_Date":"2014-12-24T16:00:00.000Z","Add_Accept":"內政部102年5月31日台內民字第1020216023號令","Remark":"桃園升格"},"arcs":[[-54,-8,-14,57]]}]}},"arcs":[[[4087,9630],[61,-15],[-31,-42],[-40,2],[10,55]],[[1963,6607],[22,-49],[-67,-32],[21,75],[24,6]],[[2170,6740],[28,-11],[54,-126],[-25,-65],[-91,32],[-47,-28],[-35,-59],[-53,49],[31,44],[-22,65],[32,37],[66,-43],[62,105]],[[6695,7533],[-52,-24],[-94,-139],[-27,-71],[-16,-145],[44,-245],[41,-43],[-18,-47],[4,-80],[-39,-19],[22,-63],[-73,-85],[-36,-212]],[[6451,6360],[-124,39],[-58,58],[0,-46],[-81,-46],[-27,34],[-61,3],[-60,44]],[[6040,6446],[-18,32],[-82,-25],[-59,56],[-11,73]],[[5870,6582],[36,76],[70,77],[3,111]],[[5979,6846],[29,20],[42,123],[27,1]],[[6077,6990],[71,25],[75,89],[-3,86],[43,37],[80,13],[52,69],[40,2],[39,76],[78,45],[-11,60],[154,41]],[[5870,6582],[-75,-7]],[[5795,6575],[3,31],[-58,106],[-59,-22],[-59,12],[-66,-21],[11,76],[-23,29],[27,56],[-96,96],[-53,72],[13,38],[-52,10]],[[5383,7058],[12,58],[62,62],[51,-34],[-16,71],[-46,50],[-76,43]],[[5370,7308],[73,149]],[[5443,7457],[71,12],[27,-70],[61,-36],[62,-11],[-7,-63],[89,-76],[28,15],[22,-49],[53,-33],[-1,-121],[68,-46],[12,-114],[51,-19]],[[5795,6575],[-34,-95],[-45,22],[-36,-62],[-172,-111],[-42,61],[-84,18],[-29,-85],[-99,-8],[-34,46],[-55,17],[-89,72],[-92,130]],[[4984,6580],[54,76],[66,206],[76,106],[61,20],[65,116]],[[5306,7104],[41,4],[36,-50]],[[4773,6169],[62,-27],[52,-132],[81,-26],[22,-126],[67,-27]],[[5057,5831],[-53,-13],[11,-78],[-31,-164],[10,-65],[69,-54],[-55,-28]],[[5008,5429],[-111,27],[-55,-2],[-98,52],[-159,-16],[-66,23],[-47,58]],[[4472,5571],[48,57],[31,93],[66,109],[7,80],[56,48],[41,146],[52,65]],[[5901,6199],[10,-42],[-81,-39],[-6,-74],[59,-37],[-8,-57],[-50,-48],[-29,-108],[23,-50],[-11,-142],[-39,-77],[-14,-100],[-27,-15],[45,-115],[-7,-85],[-29,-109],[-77,-22],[-23,-127],[-84,7],[-39,-77],[17,-43],[-46,-26]],[[5485,4813],[-21,46],[-53,13]],[[5411,4872],[-58,13],[-92,-10],[-40,132],[23,70],[-18,27],[-103,18]],[[5123,5122],[-90,-1],[-39,45],[24,82],[-10,84],[19,7],[-19,90]],[[5057,5831],[88,-27],[103,127],[8,81],[23,12],[47,-48],[79,54],[51,-12],[23,52],[53,7],[56,67],[52,6],[39,51],[15,-22],[95,53],[112,-33]],[[4295,4968],[-24,-59],[-82,-42],[106,101]],[[5123,5122],[6,-71],[-81,12],[-29,27],[-90,-18],[-54,21],[-41,72],[-92,-30],[-38,14],[-144,-114],[-26,-55],[-60,-45],[-96,29]],[[4378,4964],[-8,164],[-28,21],[66,233],[-16,44],[65,95],[15,50]],[[5411,4872],[-60,-19],[-78,-66],[-29,-86],[-80,-52],[-82,-102],[-70,21],[13,-125]],[[5025,4443],[-97,-17],[-75,40],[5,131],[22,27],[-45,29],[-12,88],[-68,33],[-120,-21],[-71,-46],[-90,-138],[-41,-11],[-91,88]],[[4342,4646],[17,78],[34,-7],[-17,160],[17,40],[-48,-1],[33,48]],[[4760,4959],[-73,-35],[8,-63],[57,-41],[89,56],[-33,57],[-48,26]],[[5292,3771],[9,-49],[39,-18],[2,-54],[-25,-101],[-109,-48],[-46,-104],[-28,-138],[31,-102],[-16,-61],[49,-71],[-43,-26],[-16,-65],[53,-37],[-6,-90],[110,-113],[38,29]],[[5334,2723],[-12,-200],[18,-49],[0,-127],[-72,-83],[-3,-65],[31,-80],[-58,57],[-76,41],[-29,-70],[-37,27],[5,78],[-36,79],[40,123],[-24,78],[-18,132],[-44,69],[-17,107],[-58,92],[-167,130],[-45,52]],[[4732,3114],[-1,74],[24,87],[-7,181],[24,93],[-1,99],[18,102],[108,-4],[66,78],[50,20],[35,-49],[41,43],[47,-12],[48,-68],[57,55],[51,-42]],[[6107,2438],[81,-1],[0,-76],[45,-43],[-43,-23],[-75,79],[-8,64]],[[6091,3481],[22,1],[-1,-77],[-44,21],[-11,51],[34,4]],[[6096,4806],[-23,-66],[-19,-144],[-39,-43],[-46,-161],[24,-128],[-62,-48],[-37,-134],[-132,-274],[-59,-51],[18,-61],[-28,-65],[-64,-76],[-124,-99],[-30,-135],[-29,-31],[-48,-197],[-67,-214],[3,-156]],[[5292,3771],[-31,69],[-22,145],[74,124],[6,94],[-11,111],[43,49],[8,103],[71,77],[72,27]],[[5502,4570],[35,-12],[28,-99],[66,-20],[23,-43],[55,8],[26,-104],[49,-21],[31,-58],[52,20],[14,77],[64,251],[59,112],[-29,43],[57,103],[64,-21]],[[6451,6360],[-39,-96],[-92,-97],[-9,-119],[-48,-66],[-7,-94],[34,-72],[-51,-81],[-11,-172],[-35,-112],[1,-73],[-52,-229],[-6,-89],[-29,-104],[12,-52],[-23,-98]],[[5502,4570],[25,49],[-78,60],[53,79],[-17,55]],[[5901,6199],[56,57],[-7,41],[69,73],[21,76]],[[3480,4436],[-28,-48],[-11,39],[39,9]],[[3663,5237],[16,-66],[43,-57],[27,6],[39,-79],[-47,-8],[-62,-84],[8,62],[-38,-5],[-15,70],[57,0],[-14,97],[-29,39],[-69,-65],[-7,-108],[-26,11],[28,149],[34,-26],[18,49],[37,15]],[[6488,7803],[-59,-52],[6,-87],[-40,-7],[-98,75],[-5,86],[76,56]],[[6368,7874],[68,-22],[52,-49]],[[5306,7104],[64,204]],[[6193,7910],[47,-118],[-17,-27],[43,-48],[3,-109],[-43,-19],[2,-65],[-48,-23],[-56,99],[-44,25],[27,79],[-59,46],[57,116],[23,-5],[54,71],[11,-22]],[[4732,3114],[-109,84],[-95,149],[-15,108],[6,95],[-81,231],[-23,112]],[[4415,3893],[18,16],[83,-48],[31,19],[97,-26],[33,54],[46,-9],[55,156],[24,-1],[121,153],[50,119],[29,29],[23,88]],[[6488,7803],[120,-30],[38,16],[-16,-68],[41,-120],[40,9],[34,-44],[-50,-33]],[[6077,6990],[-39,56],[-34,98],[29,35],[-12,54],[-56,56],[-25,-19],[-70,147],[23,22],[-11,87],[53,-3],[55,73],[-27,75],[-46,6],[-91,93]],[[5826,7770],[136,53],[80,185],[105,69],[54,11],[72,-67],[0,-37],[46,-65],[29,11],[20,-56]],[[4773,6169],[26,31],[59,159],[126,221]],[[4415,3893],[-4,67],[-42,81],[-143,126],[68,247],[18,154],[30,78]],[[5443,7457],[46,115],[41,67],[49,36],[217,106],[30,-11]]],"transform":{"scale":[0.000785569666066603,0.0005688545404540484],"translate":[116.7062384090001,20.697301579000055]}};

    var width = 800;
    var height = 650;
    
    
    var svg2 = d3.select(".s86")
                .append("svg")
                .attr("width",width)
                .attr("height",height);


    var features = topojson.feature(topodata, topodata.objects["county"]).features;

    var path = d3.geo.path().projection( // 路徑產生器
                  d3.geo.mercator().center([122.3,24]).scale(8000) // 座標變換函式
              );
    var paths = svg2.selectAll("path").data(features)
                .enter().append("path").attr("d",path);



    paths.attr('fill','#ddd')
        .attr('stroke','#555')
        .on('mouseover',function(d,i){
          // console.log(d.properties.C_Name);
          d3.select(this)
          .transition()
          .style('fill','#ccc');
        })
        .on('mouseout',function(d,i){
          d3.select(this)
          .transition()
          .style('fill','#ddd');
        })
        .on('click',function(d,i){
          if(d.properties.C_Name=='桃園市'){
            // console.log('ok');
          }
        });


        //cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="red"
    var cir_data = [{'name': '觀音洞', 'num': 645 , 'x': 352, 'y': 127},
                    {'name': '豐山村', 'num': 550 , 'x': 267, 'y': 315},
                    {'name': '崁頭山', 'num': 474 , 'x': 223, 'y': 385},
                    {'name': '明　池', 'num': 252 , 'x': 367, 'y': 153},
                    {'name': '阿里磅', 'num': 164 , 'x': 377, 'y': 57 },
                    {'name': '小獅山', 'num': 130 , 'x': 375, 'y': 100},
                    {'name': '達邦村', 'num': 267 , 'x': 265, 'y': 335}];
    var circles = svg2.selectAll('circle').data(cir_data).enter().append('circle')
                  .attr('cx',function(d){return d.x})
                  .attr('cy',function(d){return d.y})
                  .attr('r',5)
                  .style('fill','#0D6FB8')
                  .on('mouseover',function(d,i){
                    d3.select(this)
                        .style('fill','#ddd')
                        .style('stroke','#F39800')
                        .style('stroke-width',-1)
                        .transition().duration(400)
                        .style('stroke-width',2);

                    lineGraph
                        .attr("stroke", function(d,j){return i==j?"#F39800":"none"})
                        .transition().duration(400)
                        .ease("linear")
                        .attr("stroke-dashoffset", 0);

                    texts
                        .transition().duration(400).delay(400)
                        .style("fill", function(d,j){return i==j?"black":"none"});
                    tspan
                        .transition().duration(200).delay(600)
                        .style("fill", function(d,j){return i==j?"#0D6FB8":"none"});

                  })
                  .on('mouseout',function(d,i){
                    d3.select(this)
                        .transition().duration(50)
                        .attr('r',5)
                        .style('fill','#0D6FB8')
                        .style('stroke-width',0);

                    lineGraph
                        .transition().duration(50)
                        .attr("stroke-dashoffset", function(d){return d3.select(this).node().getTotalLength()});

                    texts
                        .transition().duration(50)
                        .style("fill", 'none');
                    tspan
                        .transition().duration(50)
                        .style("fill", 'none');

                  });

    var lineData = [ [{ 'x': 355, 'y': 130}, { 'x': 382, 'y': 157}, { 'x': 600, 'y': 157}],
                     [{ 'x': 270, 'y': 318}, { 'x': 297, 'y': 345}, { 'x': 600, 'y': 345}],
                     [{ 'x': 226, 'y': 388}, { 'x': 253, 'y': 415}, { 'x': 600, 'y': 415}],
                     [{ 'x': 370, 'y': 156}, { 'x': 397, 'y': 183}, { 'x': 600, 'y': 183}],
                     [{ 'x': 380, 'y': 60 }, { 'x': 407, 'y': 87 }, { 'x': 600, 'y': 87 }],
                     [{ 'x': 378, 'y': 103}, { 'x': 405, 'y': 130}, { 'x': 600, 'y': 130}],
                     [{ 'x': 268, 'y': 338}, { 'x': 295, 'y': 365}, { 'x': 600, 'y': 365}]

                   ];

    // This is the accessor function we talked about above
    var lineFunction = d3.svg.line()
    .x(function(d) {return d.x; })
    .y(function(d) {return d.y; })
    .interpolate("linear");
    // The line SVG Path we draw
    var lineGraph = svg2.selectAll('.underlines').data(lineData).enter().append("path")
    .attr("d", function(d,i){return lineFunction(d);})
    .attr("stroke", "#F39800")
    .attr("stroke-width", 2)
    .attr("fill", "none")
    .attr('class','underlines');


    lineGraph
      .attr("stroke-dasharray", function(d){return d3.select(this).node().getTotalLength() + " " + d3.select(this).node().getTotalLength()})
      .attr("stroke-dashoffset", function(d){return d3.select(this).node().getTotalLength()});


    var texts = svg2.selectAll('text').data(cir_data).enter().append('text')
                .style("fill", "none")
                .style('font-size', '16px')
                .attr("dx", 550)
                .attr("dy", function(d,i){return d.y+22})
                .text(function(d,i){
                  return d.name;
                });   

    var tspan = svg2.selectAll('text').append('tspan')
                .style("fill", "none")
                .style('font-size', '16px')
                .attr("dx", -48)
                .attr("dy", 27)
                .text(function(d,i){
                  return '資料筆數：'+d.num;
                });                



  </script>  

  <script>


        function calc_svg_cir_path_pe(x,y,perimeter,start){
            let r = Math.ceil(perimeter/(2*Math.PI));
            let d = '';
            let ci = r*0.552284;
            let w, wn, nw, n, ne, en, e, es, se, s, sw, ws;
            w  = (x-r) +','+ y    +' ';
            wn = (x-r) +','+(y-ci)+' ';
            nw = (x-ci)+','+(y-r) +' ';
            n  =  x    +','+(y-r) +' ';
            ne = (x+ci)+','+(y-r) +' ';
            en = (x+r) +','+(y-ci)+' ';
            e  = (x+r) +','+ y    +' ';
            es = (x+r) +','+(y+ci)+' ';
            se = (x+ci)+','+(y+r) +' ';
            s  =  x    +','+(y+r) +' ';
            sw = (x-ci)+','+(y+r) +' ';
            ws = (x-r) +','+(y+ci)+' ';

            if(start=='w'){
                d = 'M'+w+'C'+wn+nw+n+'C'+ne+en+e+'C'+es+se+s+'C'+sw+ws+w;
            }else if(start=='n'){
                d = 'M'+n+'C'+ne+en+e+'C'+es+se+s+'C'+sw+ws+w+'C'+wn+nw+n;
            }else if(start=='e'){
                d = 'M'+e+'C'+es+se+s+'C'+sw+ws+w+'C'+wn+nw+n+'C'+ne+en+e;
            }else if(start=='s'){
                d = 'M'+s+'C'+sw+ws+w+'C'+wn+nw+n+'C'+ne+en+e+'C'+es+se+s;
            }
            return d;
        }

        function calc_svg_line_path(x,y,long){
            let q = long/4;
            let qi = q/2;
            let d = '';
            let w, wn, nw, n, ne, en, e, es, se, s, sw, ws;
            w  =  x        +','+ y +' ';
            wn = (x+qi)    +','+ y +' ';
            nw = (x+qi)    +','+ y +' ';
            n  = (x+q*1)   +','+ y +' ';
            ne = (x+q*1+qi)+','+ y +' ';
            en = (x+q*1+qi)+','+ y +' ';
            e  = (x+q*2)   +','+ y +' ';
            es = (x+q*2+qi)+','+ y +' ';
            se = (x+q*2+qi)+','+ y +' ';
            s  = (x+q*3)   +','+ y +' ';
            sw = (x+q*3+qi)+','+ y +' ';
            ws = (x+q*3+qi)+','+ y +' ';
            w_ = (x+q*4)   +','+ y +' ';

            d = 'M'+w+'C'+wn+nw+n+'C'+ne+en+e+'C'+es+se+s+'C'+sw+ws+w_;
            return d;
        }

        var w = 800, h = 650;
        var svg1 = d3.select('.s87')
                    .append('svg')
                    .attr('width',w)
                    .attr('height',h);

        var data_1 = [{'name': '古華光', 'num': 1178},
                      {'name': '謝振邦', 'num': 923 },
                      {'name': '賴羅剛', 'num': 642 },
                      {'name': '廖文泉', 'num': 465 },
                      {'name': '福勞爾', 'num': 424 },
                      {'name': 'zero'  , 'num': 0   }];

        var linear = d3.scale.linear()
                    .domain([0, 1178])
                    .range([0, 700]);
        var ordinal= d3.scale.ordinal()
                    .domain(['','福勞爾','廖文泉','賴羅剛','謝振邦','古華光'])
                    .range([250,200,150,100,50,0]);
 
        var svg1_paths = svg1.selectAll('path').data(data_1).enter().append('path')
            .attr('d',function(d,i){
               return calc_svg_line_path(70,50+i*50,linear(d.num)) 
            })
            .attr('stroke','#999')
            .attr('stroke-width',12)
            .attr('fill','none');

        var axis = d3.svg.axis()
                     .scale(linear)
                     .orient("bottom")
                     .ticks(10); 
        var axis2= d3.svg.axis()
                     .scale(ordinal)
                     .orient("left")
                     .ticks(5);

        svg1.append("g")
            .attr("class","axis")
            .attr("transform","translate(70,300)")
            .call(axis);
        svg1.append("g")
            .attr("class","axis")
            .attr("transform","translate(70,50)")
            .call(axis2);

        var s87click = false;
        d3.select('#s87b')
          .on('click',function(){
              if(s87click){
                s87click = false;

                d3.select(this).style('background-color','#acacac');
                d3.selectAll('.s87img')
                  .transition()
                  .duration(1500)
                  .style('opacity',0); 

                svg1_paths
                  .transition()
                  .duration(2000)
                  .delay(function(d,i){
                      return 1700+200*i
                  })
                  .attr('stroke-width',12)
                  .attr('d',function(d,i){
                     return calc_svg_line_path(70,50+i*50,linear(d.num)) 
                  });


              }else{
                s87click = true;

                d3.select(this).style('background-color','#0D6FB8');
                svg1_paths
                  .transition()
                  .duration(2000)
                  .delay(function(d,i){
                      return 200*i
                  })
                  .attr('stroke-width',3)
                  .attr('d',function(d,i){
                      //直徑 224 176 122 88 82; 圓心距離 200 149 105 85
                      let x_arr = [170,372,523,630,717];
                      let direction = ['w','e','s','w','n'];
                     return calc_svg_cir_path_pe( x_arr[i], 500, linear(d.num), direction[i])
                  });


                d3.selectAll('.s87img')
                  .transition()
                  .delay(3000)
                  .duration(1500)
                  .style('opacity',1);                
              }
          })

  </script>


	</div>
</body>
</html>